<div class="auk-panel-layout__main-content">
  <div class="auk-scroll-wrapper__body">
    <div class="auk-u-m-8">
      <Auk::Panel>
        <Auk::Panel::Header
          class="{{if this.isEditing 'au-u-background-gray-100'}}"
        >
          <Auk::Toolbar as |Toolbar|>
            <Toolbar.Group @position="left" as |Group|>
              <h4 class="auk-toolbar__title">
                {{t "minutes"}}
              </h4>
            </Toolbar.Group>
            <Toolbar.Group @position="right" as |Group|>
              <Group.Item>
                <AuButton
                  @icon="pdf"
                  @skin="naked"
                  {{on "click" (perform this.exportPdf)}}
                >
                  {{t "export-as-pdf"}}
                </AuButton>
              </Group.Item>
              {{#unless this.isEditing}}
                <Group.Item>
                  <AuButton
                    @skin="naked"
                    @icon="pencil"
                    @iconAlignment="left"
                    {{on "click" (fn (set this "isEditing" true))}}
                  >
                    {{t (if @model.minutes "edit" "create")}}
                  </AuButton>
                </Group.Item>
              {{/unless}}
            </Toolbar.Group>
          </Auk::Toolbar>
        </Auk::Panel::Header>

        {{#if this.document}}
          <Auk::Panel::Body
            class="{{if this.isEditing 'au-u-background-gray-100'}}"
          >
            <div class="vlc-document-card">
              <div class="vlc-document-card__summary">
                <div class="vlc-document-card__content">
                  <Auk::Toolbar @auto={{true}} as |Toolbar|>
                    <Toolbar.Group @position="left" as |Group|>
                      <Group.Item>
                        <Auk::Badge
                          @skin="success"
                          @icon="document-added"
                          @size="large"
                        />
                      </Group.Item>
                      <Group.Item class="auk-u-maximize-width">
                        <div
                          class="auk-o-flex auk-o-flex--vertical-center auk-o-flex--spaced"
                        >
                          <span
                            data-test-document-card-type
                            class="auk-overline"
                          >
                            Notulen
                          </span>
                          <span class="auk-overline">
                            01-02-2023
                          </span>
                          <span class="auk-overline">
                            PDF
                          </span>
                        </div>
                        <LinkTo
                          @route="export.notes"
                          ,
                          target="_blank"
                          rel="noopener noreferrer"
                          class="auk-h4 au-u-flex au-u-flex--vertical-center au-u-flex--spaced-tiny"
                        >
                          DOC.02032 — Notulen
                        </LinkTo>
                      </Group.Item>
                    </Toolbar.Group>
                    <Toolbar.Group @position="right" as |Group|>
                      <Group.Item>
                        {{#if (or this.signatureRequested @signatureMockupAlt)}}
                          <SignaturePill
                            @isEditable={{true}}
                            @signatureMockupAlt={{@signatureMockupAlt}}
                          />
                        {{else if
                          (or this.signatureRequested @signatureMockup)
                        }}
                          <SignaturePill
                            @isEditable={{true}}
                            @signatureMockup={{@signatureMockup}}
                          />
                        {{else}}
                        {{/if}}
                      </Group.Item>
                      <Group.Item>
                        <AuDropdown
                          data-test-document-card-actions={{true}}
                          @icon="three-dots"
                          @title={{t "more"}}
                          @hideText={{true}}
                          @disabled={{this.loadPieceRelatedData.isRunning}}
                          @alignment="right"
                        >
                          <AuButton @skin="link" role="menuitem">
                            {{#if (eq this.signatureRequested true)}}
                              Verwijderen van handtekenen
                            {{else}}
                              Aanbieden voor handtekenen
                            {{/if}}
                          </AuButton>
                          <AuButton
                            data-test-document-card-delete
                            @skin="link"
                            @alert={{true}}
                            role="menuitem"
                          >
                            {{t "document-delete"}}
                          </AuButton>
                        </AuDropdown>
                      </Group.Item>
                    </Toolbar.Group>
                  </Auk::Toolbar>
                </div>
              </div>
              {{#if this.version}}
                <div class="vlc-document-card-versions">
                  <Auk::Accordion>
                    <Auk::Accordion::Item
                      @title={{t "previous-versions"}}
                      @disabled={{this.loadPieceRelatedData.isRunning}}
                      @expandTask={{this.loadVersionHistory}}
                      data-test-document-card-version-history
                    >
                      {{#if this.loadVersionHistory.isRunning}}
                        <div class="auk-u-p-3">
                          <Auk::Loader />
                        </div>
                      {{else}}
                        <div class="vlc-document-holder">
                          <div class="vlc-document-card-item">
                            <div class="vlc-document-card-item__title">
                              <LinkTo
                                @route="document"
                                @model={{piece.id}}
                                class="auk-h4 auk-u-m-0 auk-u-mr-4 vlc-document-card-item__title-link"
                              >
                                DOC.02032 — Notulen
                              </LinkTo>
                              <div
                                class="auk-o-flex auk-o-flex--spaced auk-o-flex--vertical-center"
                              >
                                <AuPill @icon="sign">Getekend</AuPill>
                              </div>
                            </div>
                            <div
                              class="vlc-document-card-item__meta au-u-muted"
                            >
                              {{! no piece.created in legacy data }}
                              {{#if piece.created}}
                                {{t "uploaded-at"}}
                                {{moment-format piece.created}}
                                {{t "at"}}
                                {{moment-format piece.created "HH:mm"}}
                              {{/if}}
                            </div>
                            <div class="vlc-document-card-item__icon">
                              <Auk::Icon @name="clock-rewind" @size="small" />
                            </div>
                          </div>
                        </div>
                      {{/if}}
                    </Auk::Accordion::Item>
                  </Auk::Accordion>
                </div>
              {{/if}}
            </div>
          </Auk::Panel::Body>
        {{/if}}
        <Auk::Panel::Body
          class="au-o-flow {{if this.isEditing 'au-u-background-gray-100'}}"
        >
          {{#if this.isEditing}}
            <SayEditor
              @showSave={{true}}
              @showUpdateContent={{true}}
              @showVersioning={{true}}
              @onUpdateContent={{this.updateEditorContent}}
              @handleRdfaEditorInit={{this.handleRdfaEditorInit}}
              @versioningRecord={{this.model.minutes}}
              @versioningValueKey="value"
              @versioningPreviousVersionKey="previousPiece"
            />
          {{else}}
            {{#if @model.minutes}}
              <AuContent>
                <SanitizeHtml
                  @raw={{true}}
                  @value={{this.model.minutes.value}}
                />
              </AuContent>
            {{else}}
              <AuAlert
                @title='Klik op "Aanmaken" om de notulen aan te maken'
                @icon="circle-info"
                @skin="info"
                @size="small"
                @closable={{false}}
              />
            {{/if}}
          {{/if}}
        </Auk::Panel::Body>
        {{#if this.isEditing}}
          <Auk::Panel::Footer class="au-u-background-gray-100">
            <Auk::Toolbar>
              <Auk::Toolbar::Group @position="left">
                <Auk::Toolbar::Item>
                  <AuButton
                    @skin="naked"
                    {{on "click" (fn (set this "isEditing" false))}}
                  >
                    {{t "cancel"}}
                  </AuButton>
                </Auk::Toolbar::Item>
              </Auk::Toolbar::Group>
              <Auk::Toolbar::Group @position="right">
                <Auk::Toolbar::Item>
                  <AuButton
                    @skin="primary"
                    @loading={{this.saveMinutes.isRunning}}
                    {{on "click" (perform this.saveMinutes)}}
                  >
                    {{t "save"}}
                  </AuButton>
                </Auk::Toolbar::Item>
              </Auk::Toolbar::Group>
            </Auk::Toolbar>
          </Auk::Panel::Footer>
        {{/if}}
      </Auk::Panel>

    </div>
  </div>
</div>