<div {{did-update (perform this.loadAgendaData)}}>
  <div class="auk-o-flex auk-o-flex--align-baseline">
    <h3 class="auk-h2">
      {{t "subcase"}}
    </h3>
    {{#if (user-may "manage-cases")}}
      <div class="auk-u-ml-2">
        <Auk::ButtonLink
          data-test-subcase-description-edit
          {{on "click" @onClickEdit}}
        >
          {{t "edit"}}
        </Auk::ButtonLink>
      </div>
    {{/if}}
  </div>
  <div class="auk-u-mb-4">
    <p data-test-subcase-description-subcase-name class="auk-u-text-capitalize">
      {{@subcase.subcaseName}}
    </p>
    <ul class="vlc-status-timeline">
      {{#each this.phases as |phase|}}
        <li
          class="vlc-status-timeline__item vlc-status-timeline__item--neutral"
          data-test-subcase-description-timeline-item
        >
          <div class="vlc-status-timeline__dot"></div>
          {{#if (is-pending phase)}}
            <div class="auk-skeleton auk-skeleton--rectangle" role="alert" aria-busy="true"></div>
          {{else}}
            <div class="vlc-status-timeline__text">
              {{subcase-timeline-item-text phase=phase}}
            </div>
          {{/if}}
        </li>
      {{/each}}
    </ul>
  </div>
  <div class="auk-o-grid">
    <div class="auk-o-grid-col-4">
      {{! TODO: modify test-selector strategy to be able to use <Auk::KeyValue> }}
      <div class="auk-key-value-item">
        <div class="auk-key-value-item__label">
          {{t "number-session"}}
        </div>
        <div
          data-test-subcase-description-meeting-number
          class="auk-key-value-item__value"
        >
        {{#if this.loadAgendaData.isRunning}}
            <div class="auk-loader" role="alert" aria-busy="true"></div>
        {{else if this.modelsOfMeetings}}
          {{#each this.modelsOfMeetings as |models|}}
            {{#let models.[0] as |meeting|}}
              {{meeting.number}}{{if (has-next models this.modelsOfMeetings) ", "}}
            {{/let}}
          {{/each}}
        {{else}}
          {{t "no-number-yet"}}
        {{/if}}
        </div>
      </div>
      <div class="auk-key-value-item">
        <div class="auk-key-value-item__label auk-u-max-width-xlarge">
          {{#if this.loadAgendaData.isIdle}}
            {{t "requested-for-session" kind=(kind-print-label this.latestMeeting.kind)}}
          {{/if}}
        </div>
        <div
          data-test-subcase-description-meeting-planned-start
          class="auk-key-value-item__value"
        >
          {{#if this.latestMeeting.plannedStart}}
            {{t "requested-for-agenda"}}
            {{moment-format this.latestMeeting.plannedStart "DD MMMM YYYY"}}
          {{else}}
            <p>{{t "not-yet-requested"}}</p>
          {{/if}}
        </div>
      </div>
    </div>
    <div class="auk-o-grid-col-4">
      <div class="auk-key-value-item">
        <div class="auk-key-value-item__label">
          {{t "is-on-agenda"}}
        </div>
        <div class="auk-key-value-item__value">
          {{#if this.loadAgendaData.isRunning}}
            <div class="auk-loader" role="alert" aria-busy="true"></div>
          {{else if this.modelsOfMeetings}}
            {{#each this.modelsOfMeetings as |models| }}
              {{#let models.[0] models.[1] models.[2] as |meeting agenda agendaitem|}}
              {{!-- TODO KAS-3612 this used to be shown, but seems a bit much with multiple meetings --}}
              {{!-- {{#let models.[0] models.[1] models.[2] models.[3] as |meeting agenda agendaitem resultCode|}} --}}
                {{!-- {{#if resultCode.isPostponed}}
                  {{t "postponed-subcase"}}
                {{/if}}
                {{#if resultCode.isRetracted}}
                  {{t "retracted-subcase"}}
                {{/if}} --}}
                <Auk::ButtonLink
                  data-test-subcase-description-agenda-link
                  @route="agenda.agendaitems.agendaitem"
                  @models={{array
                    meeting.id
                    agenda.id
                    agendaitem.id
                  }}
                >
                  {{moment-format meeting.plannedStart "DD MMMM YYYY"}}
                </Auk::ButtonLink>
              {{/let}}
            {{/each}}
          {{else}}
            {{t "not-yet-on-agenda"}}
          {{/if}}
        </div>
      </div>
      <div class="auk-key-value-item">
        <div class="auk-key-value-item__label">
          {{t "date-last-edited"}}
        </div>
        <div
          data-test-subcase-description-modified
          class="auk-key-value-item__value"
        >
          {{moment-format @subcase.modified "DD MMMM YYYY"}}
        </div>
      </div>
    </div>
    <div class="auk-o-grid-col-4">
      <div class="auk-key-value-item">
        <div class="auk-key-value-item__label">
          {{t "decided-on"}}
        </div>
        <div
          data-test-subcase-description-decided-on
          class="auk-key-value-item__value"
        >
          {{#if (is-empty this.approved)}}
            <div class="auk-skeleton auk-skeleton--rectangle" role="alert" aria-busy="true"></div>
          {{else if this.approved}}
            {{moment-format this.latestMeeting.plannedStart}}
          {{else}}
            {{t "not-yet-decided"}}
          {{/if}}
        </div>
      </div>
      <div class="auk-key-value-item">
        <div class="auk-key-value-item__label">
          {{t "requested-by"}}
        </div>
        <div
          data-test-subcase-description-requested-by
          class="auk-key-value-item__value"
        >
          {{#if
            (or
              (is-pending @subcase.requestedBy)
              (is-pending @subcase.requestedBy.person)
              this.loadAgendaData.isRunning
            )
          }}
            <div class="auk-skeleton auk-skeleton--rectangle" role="alert" aria-busy="true"></div>
          {{else if @subcase.requestedBy}}
            {{@subcase.requestedBy.person.nameToDisplay}}
          {{else if this.showNotYetRequestedMessage}}
            {{t "not-yet-requested"}}
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</div>