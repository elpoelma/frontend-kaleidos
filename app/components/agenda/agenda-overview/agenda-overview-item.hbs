<div class={{if @agendaitem.retracted "vlc-u-opacity-lighter"}}
  {{in-viewport
    onEnter=(perform this.lazyLoadSideData)
    onExit=this.cancelLazyLoad
  }}
>
  <div data-test-agenda-overview-item-container class="vlc-agenda-items__body ">
    <h4 class="vlc-agenda-items__subject">
      {{#if @showDragHandle}}
        <div class="vlc-agenda-items__cursor">
          {{!-- TODO: grab-hand shows over the whole parent height instead of only over the grab-handle icon --}}
          <Auk::Button
            class="auk-u-p-0 auk-u-cursor-grab"
            @skin="borderless"
          >
            <Auk::Icon @name="drag-handle-2"/>
          </Auk::Button>
        </div>
      {{/if}}
      <span class="vlc-agenda-items-sub-item__numbering">
        {{!-- For legacy data agenda-item number can be unexistent --}}
        {{#if @agendaitem.number}}
          {{@agendaitem.number}}.
        {{/if}}
      </span>
    </h4>
    <div class="vlc-agenda-items__text">
      <div class="auk-o-flex">
        <div class="left_side">
          <div class="auk-o-flex auk-o-flex--justify-between auk-o-flex--vertical-center auk-u-mb-2">
            <div class="auk-o-flex auk-o-flex--vertical-center auk-o-flex--spaced">
              <h4 class="vlc-agenda-items__subject auk-u-m-0">
                <LinkTo
                  data-test-agenda-overview-item-sub-item
                  @route="agenda.agendaitems.agendaitem"
                  @model={{@agendaitem.id}}
                  @query={{hash anchor=@agendaitem.id}}
                >
                  <pre class="auk-u-text-pre-line">
                    {{#if @agendaitem.shortTitle}}
                      {{@agendaitem.shortTitle}}
                    {{else}}
                      {{@agendaitem.title}} {{!-- Fallback for legacy data that doesnt have a short title --}}
                    {{/if}}
                  </pre>
                </LinkTo>
              </h4>
              {{#if @isNew}}
              <p class="auk-u-text-small auk-u-muted auk-u-text-nowrap auk-u-mr-2">
                <Auk::ColorBadge @skin="success" /> {{t "added-agendaitem-text"}}
              </p>
              {{/if}}
            </div>
            <div class="auk-o-flex auk-o-flex--vertical-center auk-o-flex--spaced">
              {{#if @agendaitem.isDesignAgenda}}
                {{#if this.loadNewsletterVisibility.lastSuccessful}}
                  {{#if (not this.newsletterIsVisible)}}
                    <Auk::Pill
                      @skin="future"
                      @icon="not-visible"
                      data-test-agenda-overview-item-confidentiality-locked
                    >
                    {{t "not-visible-in-newsletter"}}
                  </Auk::Pill>
                  {{/if}}
                {{else}}
                  <Auk::Pill @skin="invisible"></Auk::Pill>
                {{/if}}
                {{#if this.subcase.confidential}}
                  <Auk::Pill
                    @skin="warning-future"
                    @icon="lock-closed"
                    data-test-agenda-overview-item-confidentiality-locked
                  >
                    {{t "confidential"}}
                  </Auk::Pill>
                {{/if}}
              {{else}}
                {{#if this.loadNewsletterVisibility.lastSuccessful}}
                  {{#if (not this.newsletterIsVisible)}}
                    <Auk::Pill
                      @skin=""
                      @icon="not-visible"
                      data-test-agenda-overview-item-confidentiality-locked
                    >
                    {{t "not-visible-in-newsletter"}}
                  </Auk::Pill>
                  {{/if}}
                {{else}}
                  <Auk::Pill @skin="invisible"></Auk::Pill>
                {{/if}}
                {{#if this.subcase.confidential}}
                  <Auk::Pill
                    @skin="warning"
                    @icon="lock-closed"
                    data-test-agenda-overview-item-confidentiality-locked
                  >
                    {{t "confidential"}}
                  </Auk::Pill>
                {{/if}}
              {{/if}}
            </div>
          </div>

          {{#if (not @agendaitem.isApproval)}}
            {{#if @agendaitem.shortTitle}} {{!-- Avoid rendering the same thing twice if no "shortTitle" exists --}}
              <pre data-test-agenda-overview-item-title class="vlc-agenda-items__body-padding auk-u-text-pre-line">
                {{@agendaitem.title}}
              </pre>
            {{/if}}
          {{/if}}
        </div>
      </div>

      <div class="auk-o-flex auk-o-flex--justify-between">
        {{#if this.subcase.subcaseName}}
          <Auk::Pill class="vlc-agenda-meta__times-passed auk-u-text-capitalize">
            {{this.subcase.subcaseName}}
          </Auk::Pill>
        {{else}}
          {{!--  TODO: Only here because required for alignment of flex items --}}
          <Auk::Pill @skin="invisible"></Auk::Pill>
        {{/if}}
      </div>
      {{#if (or this.currentSession.isEditor this.documentsAreReleased)}}
        {{#if this.limitedAgendaitemDocuments}}
        <Auk::ButtonLink
          @icon={{if this.isShowingAllDocuments "chevron-down" "chevron-right"}}
          {{on "click" this.toggleShowingAllDocuments}}
          class="auk-u-text-small auk-u-mt-4"
        >
          {{#if this.isShowingAllDocuments }}
            {{t "util.hide-documents"}}
          {{else}}
            {{t "util.show-documents"}}
          {{/if}}
        </Auk::ButtonLink>
        {{/if}}
        {{#if this.isShowingAllDocuments }}
        <div class="auk-u-mt-2">
          <Documents::DocumentBadgeList
            @pieces={{this.limitedAgendaitemDocuments}}
            @highlightedPieces={{this.newAgendaitemDocuments}}
          />
        </div>
        {{/if}}
      {{/if}}
      {{#unless @isEditingFormallyOkStatus}}
        {{#if (or @agendaitem.explanation (and this.currentSession.isEditor @showFormallyOkStatus))}}
          <div class="auk-hr">
            <hr/>
          </div>
          <div class="vlc-agenda-items__remarks">
            <div>
              {{#if @agendaitem.explanation}}
                <span class="auk-u-text-bold">
                  {{t "remark-title"}}:
                </span> {{@agendaitem.explanation}}
              {{/if}}
            </div>
            <div class="vlc-agenda-items__icons">
              <div
                class="auk-o-flex vlc-agenda-items__icons"
              >
                <div class="vlc-agenda-meta__status-holder">
                  {{#if (and this.currentSession.isEditor @showFormallyOkStatus)}}
                    {{#if @isEditingFormallyOkStatus}}
                      <Utils::FormallyOkSelector
                        data-test-agenda-overview-item-formally-ok={{true}}
                        @formallyOkStatusUri={{@agendaitem.formallyOk}}
                        @onChange={{this.setAndSaveFormallyOkStatus}}
                      />
                    {{else}}
                      <p class="{{@agendaitem.formallyOkToShow.classNames}}" data-test-agenda-overview-item-status>
                        <i class="{{@agendaitem.formallyOkToShow.iconClassNames}}" aria-hidden="true"></i>
                        {{@agendaitem.formallyOkToShow.label}}
                      </p>
                    {{/if}}
                  {{/if}}
                </div>
              </div>
            </div>
          </div>
        {{/if}}
      {{/unless}}
    </div>
  </div>
</div>