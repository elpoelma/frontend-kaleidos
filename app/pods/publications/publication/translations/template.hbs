{{ page-title
  (t "translation-requests")
}}
<div class="auk-u-m-2">
  {{#if (gt this.activities.length 0)}}
    {{#each this.activities as |activity|}}
      <WebComponents::AuNavbar @noPadding="true">
        <WebComponents::AuToolbar>
          <WebComponents::AuToolbar::Group @position="left">
            <WebComponents::AuToolbar::Item>
              <h4 class="auk-toolbar-complex__title">{{t "requested-on"}} {{moment-format activity.startDate "DD MMMM YYYY [om] H:mm"}}</h4>
            </WebComponents::AuToolbar::Item>
          </WebComponents::AuToolbar::Group>
          <WebComponents::AuToolbar::Group @position="right">

            {{#if (await activity.isWithdrawn) }}

              <WebComponents::AuToolbar::Item>
                <WebComponents::AuPillList>
                  <WebComponents::AuPill @skin="danger">{{t "cancelled-request"}} {{moment-format activity.endDate "DD MMMM YYYY [om] H:mm"}}</WebComponents::AuPill>
                </WebComponents::AuPillList>
              </WebComponents::AuToolbar::Item>

            {{else if (await activity.isFinished) }}

              <WebComponents::AuToolbar::Item>
                {{t "finished"}} {{moment-format activity.endDate "DD MMMM YYYY [om] H:mm"}}
              </WebComponents::AuToolbar::Item>

            {{else}}

              <WebComponents::AuToolbar::Item>
                <WebComponents::AuButton
                        @skin="tertiary"
                  {{on "click" (fn this.showWithdrawalWindow activity)}}>
                  {{t "cancel-request"}}
                </WebComponents::AuButton>
              </WebComponents::AuToolbar::Item>

              <WebComponents::AuToolbar::Item>
                <WebComponents::AuCheckbox
                        @toggle={{fn this.markTranslationActivityDone activity}}
                        @label="Afgewerkt"/>
              </WebComponents::AuToolbar::Item>

            {{/if}}

          </WebComponents::AuToolbar::Group>
        </WebComponents::AuToolbar>
      </WebComponents::AuNavbar>
      <div class="auk-u-my-2">
        <div class="auk-o-grid">
          <div class="auk-o-grid-col auk-o-grid-col-bp2-3 auk-u-mb-3">
            <WebComponents::AuKeyValue @key={{t "final-translation-date"}} @value={{moment-format activity.finalTranslationDate "DD-MM-YYYY"}}/>
          </div>
          <div class="auk-o-grid-col-bp2-9">
            <div class="auk-u-ml-4 auk-u-mb-4">
              {{!-- Request panel --}}
              <Publications::Publication::ActivityRequestPanel @activity={{activity}}/>
            </div>
          </div>
        </div>
      </div>
      <hr class="auk-hr"/>
    {{/each}}
  {{else}}
    <WebComponents::AuPanel>
      <WebComponents::AuPanel::Body>
        <WebComponents::AuEmptyState @message={{t "no-translation-requests"}}/>
      </WebComponents::AuPanel::Body>
    </WebComponents::AuPanel>
  {{/if}}
</div>


{{!-- showWithdrawPopup --}}

{{#if showWithdrawPopup}}
  <WebComponents::AuModal
          @size="medium"
          data-test-withdraw-translation>
    <WebComponents::AuModal::Header @title={{t "cancel-request"}}
                                    @closeModal={{this.hideWithdrawalWindow}} />
    <WebComponents::AuModal::Body>
      <div class="auk-form-group-layout auk-form-group-layout--standard">
        <div class='auk-form-group'>
          <WebComponents::AuLabel for="reason">{{t "reason-withdraw"}}</WebComponents::AuLabel>
          <WebComponents::AuTextarea
                  @rows="5"
                  @value={{this.withdrawalReason}}
                  data-test-publication-activity-withdrawal-reason-textarea
          ></WebComponents::AuTextarea>
        </div>
        <div class='auk-form-group'>
          <WebComponents::AuLabel for="subject">{{t "subject"}}</WebComponents::AuLabel>
          <WebComponents::AuInput
            @block="true"
            type="text"
            id="subject"
            @value={{this.withdrawalSubject}}
          />
        </div>
        <div class='auk-form-group'>
          <WebComponents::AuLabel for="reason">{{t "content"}}</WebComponents::AuLabel>
          <WebComponents::AuTextarea
            @rows="8"
            @value={{this.withdrawalContent}}
            data-test-publication-activity-withdrawal-textarea
          ></WebComponents::AuTextarea>
        </div>
      </div>
    </WebComponents::AuModal::Body>
    {{!-- TODO, use the template, yield the buttons in the right toolbar--}}
    <WebComponents::AuModal::Footer @custom={{true}}>
      <WebComponents::AuToolbar>
        <WebComponents::AuToolbar::Group @position="left">
          <WebComponents::AuToolbar::Item>
            <WebComponents::AuButton
              @skin="borderless"
              {{on "click" this.hideWithdrawalWindow}}
            >
              {{t "cancel"}}
            </WebComponents::AuButton>
          </WebComponents::AuToolbar::Item>
        </WebComponents::AuToolbar::Group>
        <WebComponents::AuToolbar::Group @position="right">
          <WebComponents::AuToolbar::Item>
            <WebComponents::AuButton
              @skin="primary"
              @icon="close"
              @size="small"
              {{on "click" this.cancelExistingTranslationActivity}}
              data-test-withdraw-activity-submit-button
            >
              {{t "cancel-request"}}
            </WebComponents::AuButton>
          </WebComponents::AuToolbar::Item>
        </WebComponents::AuToolbar::Group>
      </WebComponents::AuToolbar>
    </WebComponents::AuModal::Footer>
  </WebComponents::AuModal>
{{/if}}

{{!-- LOADER --}}

{{#if this.showLoader}}
  <WebComponents::AuLoadingOverlay/>
{{/if}}